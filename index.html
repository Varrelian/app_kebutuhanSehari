<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MoneyTracker - Aplikasi Catatan Pengeluaran</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --success: #4cc9f0;
      --danger: #f72585;
      --warning: #f8961e;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --light-gray: #e9ecef;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--dark);
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    header {
      background: var(--primary);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    
    .app-title {
      font-size: 28px;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .app-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .budget-summary {
      display: flex;
      justify-content: space-around;
      padding: 15px;
      background: var(--secondary);
      color: white;
    }
    
    .budget-item {
      text-align: center;
    }
    
    .budget-label {
      font-size: 12px;
      margin-bottom: 5px;
    }
    
    .budget-amount {
      font-size: 18px;
      font-weight: bold;
    }
    
    .main-content {
      padding: 20px;
    }
    
    .section-title {
      font-size: 18px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--light-gray);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .input-group {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    input, select, button, textarea {
      padding: 12px 15px;
      border: 1px solid var(--light-gray);
      border-radius: 8px;
      font-size: 16px;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }
    
    .btn {
      background: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    .btn:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background: var(--danger);
    }
    
    .btn-danger:hover {
      background: #d11466;
    }
    
    .btn-warning {
      background: var(--warning);
    }
    
    .btn-warning:hover {
      background: #e4850b;
    }
    
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      background: var(--light);
      color: var(--dark);
      border: 1px solid var(--light-gray);
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .filter-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .expenses-list {
      margin-bottom: 30px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .expense-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      border-bottom: 1px solid var(--light-gray);
      transition: all 0.3s;
    }
    
    .expense-item:hover {
      background: var(--light);
    }
    
    .expense-info {
      flex: 1;
    }
    
    .expense-name {
      font-weight: 500;
    }
    
    .expense-category {
      font-size: 12px;
      color: var(--gray);
      margin-top: 3px;
    }
    
    .expense-amount {
      font-weight: bold;
      margin: 0 15px;
    }
    
    .expense-date {
      font-size: 12px;
      color: var(--gray);
      margin-right: 15px;
    }
    
    .action-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: var(--gray);
      font-size: 16px;
      transition: all 0.3s;
    }
    
    .action-btn:hover {
      color: var(--danger);
    }
    
    .chart-container {
      background: var(--light);
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }
    
    .chart {
      display: flex;
      height: 200px;
      align-items: flex-end;
      gap: 10px;
      padding-top: 20px;
    }
    
    .chart-bar {
      flex: 1;
      background: var(--primary);
      border-radius: 5px 5px 0 0;
      position: relative;
      transition: all 0.3s;
    }
    
    .chart-bar:hover {
      background: var(--secondary);
    }
    
    .chart-label {
      position: absolute;
      bottom: -25px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 12px;
      color: var(--gray);
    }
    
    .category-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .category-stat {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .category-name {
      font-weight: bold;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .category-amount {
      font-size: 18px;
      color: var(--primary);
    }
    
    .category-percentage {
      font-size: 12px;
      color: var(--gray);
      margin-top: 5px;
    }
    
    .empty-state {
      text-align: center;
      padding: 30px;
      color: var(--gray);
    }
    
    .empty-state i {
      font-size: 50px;
      margin-bottom: 15px;
      color: var(--light-gray);
    }
    
    footer {
      text-align: center;
      padding: 20px;
      background: var(--light);
      color: var(--gray);
      font-size: 14px;
    }
    
    /* Tabs styling */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--light-gray);
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      transition: all 0.3s;
      border-bottom: 3px solid transparent;
    }
    
    .tab.active {
      border-bottom: 3px solid var(--primary);
      color: var(--primary);
      font-weight: bold;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Budget alert styling */
    .budget-alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .budget-alert.warning {
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffc107;
    }
    
    .budget-alert.danger {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
    
    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray);
    }
    
    /* Goal progress styling */
    .goal-progress {
      margin-bottom: 20px;
    }
    
    .progress-bar {
      height: 20px;
      background: var(--light-gray);
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 10px;
      transition: width 0.5s;
    }
    
    .goal-details {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 14px;
      color: var(--gray);
    }
    
    @media (max-width: 600px) {
      .input-group {
        grid-template-columns: 1fr;
      }
      
      .expense-item {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .expense-details {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin-top: 10px;
      }
      
      .category-stats {
        grid-template-columns: 1fr;
      }
      
      .tabs {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1 class="app-title"><i class="fas fa-money-bill-wave"></i> MoneyTracker</h1>
      <p class="app-subtitle">Kelola pengeluaran harianmu dengan mudah</p>
    </header>
    
    <div class="budget-summary">
      <div class="budget-item">
        <div class="budget-label">Total Pengeluaran</div>
        <div class="budget-amount" id="total-pengeluaran">Rp 0</div>
      </div>
      <div class="budget-item">
        <div class="budget-label">Pengeluaran Hari Ini</div>
        <div class="budget-amount" id="pengeluaran-hari-ini">Rp 0</div>
      </div>
      <div class="budget-item">
        <div class="budget-label">Rata-rata per Hari</div>
        <div class="budget-amount" id="rata-rata">Rp 0</div>
      </div>
    </div>
    
    <div class="main-content">
      <div class="tabs">
        <div class="tab active" data-tab="pengeluaran">Pengeluaran</div>
        <div class="tab" data-tab="anggaran">Anggaran</div>
        <div class="tab" data-tab="target">Target Tabungan</div>
        <div class="tab" data-tab="analisis">Analisis</div>
      </div>
      
      <!-- Tab Pengeluaran -->
      <div class="tab-content active" id="pengeluaran-tab">
        <h2 class="section-title"><i class="fas fa-plus-circle"></i> Tambah Pengeluaran Baru</h2>
        
        <div class="input-group">
          <input type="text" id="nama-pengeluaran" placeholder="Untuk apa pengeluaran ini?">
          <input type="number" id="jumlah-pengeluaran" placeholder="Jumlah (Rp)">
          <select id="kategori-pengeluaran">
            <option value="makanan">Makanan & Minuman</option>
            <option value="transportasi">Transportasi</option>
            <option value="belanja">Belanja</option>
            <option value="hiburan">Hiburan</option>
            <option value="utilitas">Utilitas</option>
            <option value="kesehatan">Kesehatan</option>
            <option value="lainnya">Lainnya</option>
          </select>
        </div>
        
        <textarea id="catatan-pengeluaran" placeholder="Tambahkan catatan (opsional)" rows="2"></textarea>
        
        <button class="btn" onclick="tambahPengeluaran()" style="margin-top: 10px;">
          <i class="fas fa-plus"></i> Tambah Pengeluaran
        </button>
        
        <h2 class="section-title" style="margin-top: 30px;"><i class="fas fa-list"></i> Daftar Pengeluaran</h2>
        
        <div class="filters">
          <div class="filter-btn active" data-filter="semua">Semua</div>
          <div class="filter-btn" data-filter="hari-ini">Hari Ini</div>
          <div class="filter-btn" data-filter="minggu-ini">Minggu Ini</div>
          <div class="filter-btn" data-filter="bulan-ini">Bulan Ini</div>
          <select id="kategori-filter" style="margin-left: auto;">
            <option value="semua">Semua Kategori</option>
            <option value="makanan">Makanan & Minuman</option>
            <option value="transportasi">Transportasi</option>
            <option value="belanja">Belanja</option>
            <option value="hiburan">Hiburan</option>
            <option value="utilitas">Utilitas</option>
            <option value="kesehatan">Kesehatan</option>
            <option value="lainnya">Lainnya</option>
          </select>
        </div>
        
        <div class="expenses-list" id="daftar-pengeluaran">
          <div class="empty-state">
            <i class="fas fa-receipt"></i>
            <p>Belum ada pengeluaran yang dicatat</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Anggaran -->
      <div class="tab-content" id="anggaran-tab">
        <h2 class="section-title"><i class="fas fa-wallet"></i> Kelola Anggaran Bulanan</h2>
        
        <div id="budget-alerts">
          <!-- Alert akan ditampilkan di sini -->
        </div>
        
        <div class="input-group">
          <select id="kategori-anggaran">
            <option value="makanan">Makanan & Minuman</option>
            <option value="transportasi">Transportasi</option>
            <option value="belanja">Belanja</option>
            <option value="hiburan">Hiburan</option>
            <option value="utilitas">Utilitas</option>
            <option value="kesehatan">Kesehatan</option>
            <option value="lainnya">Lainnya</option>
          </select>
          <input type="number" id="jumlah-anggaran" placeholder="Jumlah anggaran (Rp)">
          <button class="btn" onclick="tambahAnggaran()">
            <i class="fas fa-plus"></i> Set Anggaran
          </button>
        </div>
        
        <h2 class="section-title" style="margin-top: 30px;"><i class="fas fa-chart-pie"></i> Anggaran per Kategori</h2>
        
        <div id="daftar-anggaran">
          <div class="empty-state">
            <i class="fas fa-wallet"></i>
            <p>Belum ada anggaran yang ditetapkan</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Target Tabungan -->
      <div class="tab-content" id="target-tab">
        <h2 class="section-title"><i class="fas fa-piggy-bank"></i> Target Menabung</h2>
        
        <div class="input-group">
          <input type="text" id="nama-target" placeholder="Nama target menabung">
          <input type="number" id="jumlah-target" placeholder="Jumlah target (Rp)">
          <button class="btn" onclick="tambahTarget()">
            <i class="fas fa-plus"></i> Tambah Target
          </button>
        </div>
        
        <div id="daftar-target">
          <div class="empty-state">
            <i class="fas fa-bullseye"></i>
            <p>Belum ada target menabung</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Analisis -->
      <div class="tab-content" id="analisis-tab">
        <h2 class="section-title"><i class="fas fa-chart-line"></i> Analisis Pengeluaran</h2>
        
        <div class="chart-container">
          <div class="chart" id="chart">
            <!-- Chart bars akan di-generate oleh JavaScript -->
          </div>
        </div>
        
        <h2 class="section-title" style="margin-top: 30px;"><i class="fas fa-chart-bar"></i> Pengeluaran per Kategori</h2>
        
        <div class="category-stats" id="category-stats">
          <!-- Statistik kategori akan di-generate oleh JavaScript -->
        </div>
        
        <button class="btn" onclick="eksporData()" style="margin-top: 20px;">
          <i class="fas fa-download"></i> Ekspor Data Pengeluaran
        </button>
      </div>
    </div>
    
    <footer>
      <p>&copy; 2023 MoneyTracker - Aplikasi Catatan Pengeluaran</p>
    </footer>
  </div>

  <!-- Modal untuk detail pengeluaran -->
  <div class="modal" id="detail-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Detail Pengeluaran</h2>
        <button class="close-modal" onclick="tutupModal()">&times;</button>
      </div>
      <div id="modal-body">
        <!-- Konten modal akan diisi oleh JavaScript -->
      </div>
    </div>
  </div>

  <script>
    let pengeluaran = [];
    let anggaran = [];
    let targetTabungan = [];
    
    // Inisialisasi data contoh untuk demonstrasi
    function initContohData() {
      const contohData = [
        { id: 1, nama: "Makan Siang", jumlah: 45000, kategori: "makanan", tanggal: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(), catatan: "Makan siang di kantin" },
        { id: 2, nama: "Bensin Motor", jumlah: 25000, kategori: "transportasi", tanggal: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(), catatan: "Isi bensin di SPBU" },
        { id: 3, nama: "Netflix", jumlah: 55000, kategori: "hiburan", tanggal: new Date().toISOString(), catatan: "Langganan bulanan" },
        { id: 4, nama: "Belanja Bulanan", jumlah: 350000, kategori: "belanja", tanggal: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), catatan: "Bahan makanan untuk seminggu" },
        { id: 5, nama: "Obat", jumlah: 75000, kategori: "kesehatan", tanggal: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(), catatan: "Obat flu dan vitamin" }
      ];
      
      const contohAnggaran = [
        { kategori: "makanan", jumlah: 1000000 },
        { kategori: "transportasi", jumlah: 500000 },
        { kategori: "hiburan", jumlah: 300000 }
      ];
      
      const contohTarget = [
        { id: 1, nama: "Liburan Akhir Tahun", target: 5000000, terkumpul: 1250000 }
      ];
      
      // Hanya tambah data contoh jika belum ada data di localStorage
      if (!localStorage.getItem('pengeluaran')) {
        pengeluaran = contohData;
        simpanData('pengeluaran', pengeluaran);
      }
      
      if (!localStorage.getItem('anggaran')) {
        anggaran = contohAnggaran;
        simpanData('anggaran', anggaran);
      }
      
      if (!localStorage.getItem('targetTabungan')) {
        targetTabungan = contohTarget;
        simpanData('targetTabungan', targetTabungan);
      }
    }
    
    // Muat data dari localStorage
    function muatData() {
      if (localStorage.getItem('pengeluaran')) {
        pengeluaran = JSON.parse(localStorage.getItem('pengeluaran'));
      }
      
      if (localStorage.getItem('anggaran')) {
        anggaran = JSON.parse(localStorage.getItem('anggaran'));
      }
      
      if (localStorage.getItem('targetTabungan')) {
        targetTabungan = JSON.parse(localStorage.getItem('targetTabungan'));
      }
    }
    
    // Inisialisasi
    muatData();
    initContohData();
    hitungTotalPengeluaran();
    tampilkanPengeluaran();
    updateChart();
    updateCategoryStats();
    tampilkanAnggaran();
    tampilkanTarget();
    updateBudgetAlerts();
    
    // Fungsi untuk tiga fitur baru
    
    // 1. FITUR ANGGARAN BULANAN
    function tambahAnggaran() {
      const kategoriInput = document.getElementById('kategori-anggaran');
      const jumlahInput = document.getElementById('jumlah-anggaran');
      
      const kategori = kategoriInput.value;
      const jumlah = parseInt(jumlahInput.value);
      
      if (jumlah && jumlah > 0) {
        // Cek apakah anggaran untuk kategori ini sudah ada
        const index = anggaran.findIndex(item => item.kategori === kategori);
        
        if (index !== -1) {
          // Update anggaran yang sudah ada
          anggaran[index].jumlah = jumlah;
        } else {
          // Tambah anggaran baru
          anggaran.push({ kategori, jumlah });
        }
        
        simpanData('anggaran', anggaran);
        tampilkanAnggaran();
        updateBudgetAlerts();
        
        // Reset form
        jumlahInput.value = '';
      } else {
        alert('Harap isi jumlah anggaran dengan benar!');
      }
    }
    
    function tampilkanAnggaran() {
      const daftarElement = document.getElementById('daftar-anggaran');
      
      if (anggaran.length === 0) {
        daftarElement.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-wallet"></i>
            <p>Belum ada anggaran yang ditetapkan</p>
          </div>
        `;
        return;
      }
      
      daftarElement.innerHTML = '';
      
      anggaran.forEach(item => {
        // Hitung total pengeluaran untuk kategori ini
        const totalPengeluaran = pengeluaran
          .filter(p => p.kategori === item.kategori)
          .reduce((total, p) => total + p.jumlah, 0);
        
        const persentase = Math.min(100, Math.round((totalPengeluaran / item.jumlah) * 100));
        
        const anggaranElement = document.createElement('div');
        anggaranElement.className = 'category-stat';
        anggaranElement.innerHTML = `
          <div class="category-name">
            <i class="fas fa-${getIconKategori(item.kategori)}"></i>
            ${getNamaKategori(item.kategori)}
          </div>
          <div class="category-amount">${formatRupiah(totalPengeluaran)} / ${formatRupiah(item.jumlah)}</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${persentase}%; background: ${persentase > 90 ? 'var(--danger)' : persentase > 75 ? 'var(--warning)' : 'var(--primary)'}"></div>
          </div>
          <div class="category-percentage">${persentase}% digunakan</div>
          <button class="action-btn" onclick="hapusAnggaran('${item.kategori}')" style="margin-top: 10px;">
            <i class="fas fa-trash"></i> Hapus Anggaran
          </button>
        `;
        daftarElement.appendChild(anggaranElement);
      });
    }
    
    function hapusAnggaran(kategori) {
      if (confirm('Apakah Anda yakin ingin menghapus anggaran untuk kategori ini?')) {
        anggaran = anggaran.filter(item => item.kategori !== kategori);
        simpanData('anggaran', anggaran);
        tampilkanAnggaran();
        updateBudgetAlerts();
      }
    }
    
    function updateBudgetAlerts() {
      const alertsElement = document.getElementById('budget-alerts');
      alertsElement.innerHTML = '';
      
      anggaran.forEach(item => {
        // Hitung total pengeluaran untuk kategori ini
        const totalPengeluaran = pengeluaran
          .filter(p => p.kategori === item.kategori)
          .reduce((total, p) => total + p.jumlah, 0);
        
        const persentase = Math.round((totalPengeluaran / item.jumlah) * 100);
        
        if (persentase >= 90) {
          const alertElement = document.createElement('div');
          alertElement.className = 'budget-alert danger';
          alertElement.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            <div>
              <strong>Peringatan!</strong> Pengeluaran ${getNamaKategori(item.kategori)} telah mencapai ${persentase}% dari anggaran.
            </div>
          `;
          alertsElement.appendChild(alertElement);
        } else if (persentase >= 75) {
          const alertElement = document.createElement('div');
          alertElement.className = 'budget-alert warning';
          alertElement.innerHTML = `
            <i class="fas fa-exclamation-circle"></i>
            <div>
              <strong>Perhatian!</strong> Pengeluaran ${getNamaKategori(item.kategori)} telah mencapai ${persentase}% dari anggaran.
            </div>
          `;
          alertsElement.appendChild(alertElement);
        }
      });
    }
    
    // 2. FITUR TARGET TABUNGAN
    function tambahTarget() {
      const namaInput = document.getElementById('nama-target');
      const jumlahInput = document.getElementById('jumlah-target');
      
      const nama = namaInput.value.trim();
      const target = parseInt(jumlahInput.value);
      
      if (nama && target && target > 0) {
        const id = Date.now();
        
        targetTabungan.push({
          id,
          nama,
          target,
          terkumpul: 0
        });
        
        simpanData('targetTabungan', targetTabungan);
        tampilkanTarget();
        
        // Reset form
        namaInput.value = '';
        jumlahInput.value = '';
      } else {
        alert('Harap isi nama dan jumlah target dengan benar!');
      }
    }
    
    function tampilkanTarget() {
      const daftarElement = document.getElementById('daftar-target');
      
      if (targetTabungan.length === 0) {
        daftarElement.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-bullseye"></i>
            <p>Belum ada target menabung</p>
          </div>
        `;
        return;
      }
      
      daftarElement.innerHTML = '';
      
      targetTabungan.forEach(item => {
        const persentase = Math.min(100, Math.round((item.terkumpul / item.target) * 100));
        
        const targetElement = document.createElement('div');
        targetElement.className = 'category-stat';
        targetElement.innerHTML = `
          <div class="category-name">
            <i class="fas fa-piggy-bank"></i>
            ${item.nama}
          </div>
          <div class="category-amount">${formatRupiah(item.terkumpul)} / ${formatRupiah(item.target)}</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${persentase}%"></div>
          </div>
          <div class="goal-details">
            <span>${persentase}% tercapai</span>
            <span>${formatRupiah(item.target - item.terkumpul)} lagi</span>
          </div>
          <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button class="btn" onclick="tambahTabungan(${item.id}, 100000)">
              + Rp 100rb
            </button>
            <button class="btn btn-danger" onclick="hapusTarget(${item.id})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        daftarElement.appendChild(targetElement);
      });
    }
    
    function tambahTabungan(id, jumlah) {
      const index = targetTabungan.findIndex(item => item.id === id);
      
      if (index !== -1) {
        targetTabungan[index].terkumpul += jumlah;
        
        // Jika melebihi target, set ke target
        if (targetTabungan[index].terkumpul > targetTabungan[index].target) {
          targetTabungan[index].terkumpul = targetTabungan[index].target;
        }
        
        simpanData('targetTabungan', targetTabungan);
        tampilkanTarget();
      }
    }
    
    function hapusTarget(id) {
      if (confirm('Apakah Anda yakin ingin menghapus target menabung ini?')) {
        targetTabungan = targetTabungan.filter(item => item.id !== id);
        simpanData('targetTabungan', targetTabungan);
        tampilkanTarget();
      }
    }
    
    // 3. FITUR EKSPOR DATA
    function eksporData() {
      // Format data untuk CSV
      let csvContent = "Data Pengeluaran\n\n";
      csvContent += "Tanggal,Nama,Kategori,Jumlah,Catatan\n";
      
      pengeluaran.forEach(item => {
        const tanggal = new Date(item.tanggal).toLocaleDateString('id-ID');
        const nama = item.name;
        const kategori = getNamaKategori(item.kategori);
        const jumlah = item.jumlah;
        const catatan = item.catatan || '';
        
        csvContent += `"${tanggal}","${nama}","${kategori}","${jumlah}","${catatan}"\n`;
      });
      
      // Buat blob dan download link
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      
      link.setAttribute('href', url);
      link.setAttribute('download', 'laporan-pengeluaran.csv');
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Fungsi-fungsi yang sudah ada sebelumnya
    function tambahPengeluaran() {
      const namaInput = document.getElementById('nama-pengeluaran');
      const jumlahInput = document.getElementById('jumlah-pengeluaran');
      const kategoriInput = document.getElementById('kategori-pengeluaran');
      const catatanInput = document.getElementById('catatan-pengeluaran');
      
      const nama = namaInput.value.trim();
      const jumlah = parseInt(jumlahInput.value);
      const kategori = kategoriInput.value;
      const catatan = catatanInput.value.trim();
      
      if (nama && jumlah && jumlah > 0) {
        const tanggal = new Date().toISOString();
        
        const pengeluaranBaru = {
          id: Date.now(),
          nama,
          jumlah,
          kategori,
          tanggal,
          catatan
        };
        
        pengeluaran.push(pengeluaranBaru);
        simpanData('pengeluaran', pengeluaran);
        hitungTotalPengeluaran();
        tampilkanPengeluaran();
        updateChart();
        updateCategoryStats();
        updateBudgetAlerts();
        
        // Reset form
        namaInput.value = '';
        jumlahInput.value = '';
        catatanInput.value = '';
        namaInput.focus();
      } else {
        alert('Harap isi nama dan jumlah pengeluaran dengan benar!');
      }
    }
    
    function hapusPengeluaran(id) {
      if (confirm('Apakah Anda yakin ingin menghapus pengeluaran ini?')) {
        pengeluaran = pengeluaran.filter(item => item.id !== id);
        simpanData('pengeluaran', pengeluaran);
        hitungTotalPengeluaran();
        tampilkanPengeluaran();
        updateChart();
        updateCategoryStats();
        updateBudgetAlerts();
      }
    }
    
    function simpanData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }
    
    function hitungTotalPengeluaran() {
      const total = pengeluaran.reduce((total, item) => total + item.jumlah, 0);
      
      // Hitung pengeluaran hari ini
      const hariIni = new Date().toDateString();
      const pengeluaranHariIni = pengeluaran
        .filter(item => new Date(item.tanggal).toDateString() === hariIni)
        .reduce((total, item) => total + item.jumlah, 0);
      
      // Hitung rata-rata per hari
      const hariDenganPengeluaran = new Set(pengeluaran.map(item => new Date(item.tanggal).toDateString())).size;
      const rataRata = hariDenganPengeluaran > 0 ? Math.round(total / hariDenganPengeluaran) : 0;
      
      document.getElementById('total-pengeluaran').textContent = formatRupiah(total);
      document.getElementById('pengeluaran-hari-ini').textContent = formatRupiah(pengeluaranHariIni);
      document.getElementById('rata-rata').textContent = formatRupiah(rataRata);
    }
    
    function formatRupiah(angka) {
      return 'Rp ' + angka.toLocaleString('id-ID');
    }
    
    function formatTanggal(tanggal) {
      const options = { 
        day: '2-digit', 
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return new Date(tanggal).toLocaleDateString('id-ID', options);
    }
    
    function getNamaKategori(kategori) {
      const kategoriMap = {
        'makanan': 'Makanan & Minuman',
        'transportasi': 'Transportasi',
        'belanja': 'Belanja',
        'hiburan': 'Hiburan',
        'utilitas': 'Utilitas',
        'kesehatan': 'Kesehatan',
        'lainnya': 'Lainnya'
      };
      
      return kategoriMap[kategori] || 'Lainnya';
    }
    
    function getIconKategori(kategori) {
      const iconMap = {
        'makanan': 'utensils',
        'transportasi': 'car',
        'belanja': 'shopping-bag',
        'hiburan': 'film',
        'utilitas': 'bolt',
        'kesehatan': 'heartbeat',
        'lainnya': 'receipt'
      };
      
      return iconMap[kategori] || 'receipt';
    }
    
    function tampilkanPengeluaran() {
      const daftarElement = document.getElementById('daftar-pengeluaran');
      const filter = document.querySelector('.filter-btn.active').dataset.filter;
      const kategoriFilter = document.getElementById('kategori-filter').value;
      
      // Filter pengeluaran
      let pengeluaranTertampil = [...pengeluaran];
      
      // Filter berdasarkan waktu
      const sekarang = new Date();
      if (filter === 'hari-ini') {
        const hariIni = sekarang.toDateString();
        pengeluaranTertampil = pengeluaranTertampil.filter(
          item => new Date(item.tanggal).toDateString() === hariIni
        );
      } else if (filter === 'minggu-ini') {
        const mingguLalu = new Date(sekarang.getTime() - 7 * 24 * 60 * 60 * 1000);
        pengeluaranTertampil = pengeluaranTertampil.filter(
          item => new Date(item.tanggal) >= mingguLalu
        );
      } else if (filter === 'bulan-ini') {
        const awalBulan = new Date(sekarang.getFullYear(), sekarang.getMonth(), 1);
        pengeluaranTertampil = pengeluaranTertampil.filter(
          item => new Date(item.tanggal) >= awalBulan
        );
      }
      
      // Filter berdasarkan kategori
      if (kategoriFilter !== 'semua') {
        pengeluaranTertampil = pengeluaranTertampil.filter(
          item => item.kategori === kategoriFilter
        );
      }
      
      // Urutkan dari yang terbaru
      pengeluaranTertampil.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
      
      if (pengeluaranTertampil.length === 0) {
        daftarElement.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-receipt"></i>
            <p>Tidak ada pengeluaran yang sesuai dengan filter</p>
          </div>
        `;
        return;
      }
      
      daftarElement.innerHTML = '';
      pengeluaranTertampil.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'expense-item';
        itemElement.innerHTML = `
          <div class="expense-info">
            <div class="expense-name">${item.nama}</div>
            <div class="expense-category">${getNamaKategori(item.kategori)}</div>
          </div>
          <div class="expense-details">
            <div class="expense-amount">${formatRupiah(item.jumlah)}</div>
            <div class="expense-date">${formatTanggal(item.tanggal)}</div>
            <div>
              <button class="action-btn" onclick="lihatDetail(${item.id})" title="Lihat detail">
                <i class="fas fa-eye"></i>
              </button>
              <button class="action-btn" onclick="hapusPengeluaran(${item.id})" title="Hapus">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
        daftarElement.appendChild(itemElement);
      });
    }
    
    function lihatDetail(id) {
      const item = pengeluaran.find(p => p.id === id);
      if (item) {
        const modalBody = document.getElementById('modal-body');
        modalBody.innerHTML = `
          <p><strong>Nama:</strong> ${item.nama}</p>
          <p><strong>Jumlah:</strong> ${formatRupiah(item.jumlah)}</p>
          <p><strong>Kategori:</strong> ${getNamaKategori(item.kategori)}</p>
          <p><strong>Tanggal:</strong> ${formatTanggal(item.tanggal)}</p>
          <p><strong>Catatan:</strong> ${item.catatan || 'Tidak ada catatan'}</p>
        `;
        
        document.getElementById('detail-modal').style.display = 'flex';
      }
    }
    
    function tutupModal() {
      document.getElementById('detail-modal').style.display = 'none';
    }
    
    function updateChart() {
      const chartElement = document.getElementById('chart');
      chartElement.innerHTML = '';
      
      // Hitung pengeluaran per hari dalam minggu ini
      const hariDalamMinggu = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
      const sekarang = new Date();
      const startOfWeek = new Date(sekarang);
      startOfWeek.setDate(sekarang.getDate() - sekarang.getDay()); // Mulai dari Minggu
      
      const dataHarian = Array(7).fill(0);
      
      pengeluaran.forEach(item => {
        const tanggal = new Date(item.tanggal);
        // Cek apakah tanggal dalam minggu ini
        if (tanggal >= startOfWeek) {
          const hari = tanggal.getDay(); // 0 (Minggu) sampai 6 (Sabtu)
          dataHarian[hari] += item.jumlah;
        }
      });
      
      const maxValue = Math.max(...dataHarian);
      
      hariDalamMinggu.forEach((hari, index) => {
        const height = maxValue > 0 ? (dataHarian[index] / maxValue) * 100 : 0;
        const bar = document.createElement('div');
        bar.className = 'chart-bar';
        bar.style.height = `${height}%`;
        bar.innerHTML = `
          <div class="chart-label">${hari}</div>
          <div style="position: absolute; top: -25px; left: 0; right: 0; text-align: center; font-size: 12px;">
            ${formatRupiah(dataHarian[index])}
          </div>
        `;
        chartElement.appendChild(bar);
      });
    }
    
    function updateCategoryStats() {
      const categoryStatsElement = document.getElementById('category-stats');
      categoryStatsElement.innerHTML = '';
      
      // Hitung total pengeluaran
      const total = pengeluaran.reduce((sum, item) => sum + item.jumlah, 0);
      
      // Hitung pengeluaran per kategori
      const pengeluaranPerKategori = {};
      pengeluaran.forEach(item => {
        if (!pengeluaranPerKategori[item.kategori]) {
          pengeluaranPerKategori[item.kategori] = 0;
        }
        pengeluaranPerKategori[item.kategori] += item.jumlah;
      });
      
      // Tampilkan statistik per kategori
      for (const [kategori, jumlah] of Object.entries(pengeluaranPerKategori)) {
        const persentase = total > 0 ? ((jumlah / total) * 100).toFixed(1) : 0;
        
        const statElement = document.createElement('div');
        statElement.className = 'category-stat';
        statElement.innerHTML = `
          <div class="category-name">
            <i class="fas fa-${getIconKategori(kategori)}"></i>
            ${getNamaKategori(kategori)}
          </div>
          <div class="category-amount">${formatRupiah(jumlah)}</div>
          <div class="category-percentage">${persentase}% dari total pengeluaran</div>
        `;
        categoryStatsElement.appendChild(statElement);
      }
    }
    
    // Event listener untuk tab
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        
        // Aktifkan tab yang diklik
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Tampilkan konten tab yang sesuai
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.remove('active');
        });
        document.getElementById(`${tabId}-tab`).classList.add('active');
      });
    });
    
    // Event listener untuk filter
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        tampilkanPengeluaran();
      });
    });
    
    document.getElementById('kategori-filter').addEventListener('change', tampilkanPengeluaran);
    
    // Tutup modal jika klik di luar konten modal
    window.addEventListener('click', (event) => {
      const modal = document.getElementById('detail-modal');
      if (event.target === modal) {
        tutupModal();
      }
    });
    
    // Fokus ke input pertama saat halaman dimuat
    document.getElementById('nama-pengeluaran').focus();
  </script>
</body>
</html>
